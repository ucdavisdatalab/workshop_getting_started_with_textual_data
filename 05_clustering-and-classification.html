
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>5. Clustering and Classification &#8212; Getting Started with Textual Data</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="6. Topic Modeling" href="06_topic-modeling.html" />
    <link rel="prev" title="4. Corpus Analytics" href="04_corpus-analytics.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/datalab-logo-full-color-rgb.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Getting Started with Textual Data</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="index.html">
   Overview
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01_logistics.html">
   1. Before We Begin…
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_from-text-to-data.html">
   2. From Text to Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_cleaning-and-counting.html">
   3. Cleaning and Counting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_corpus-analytics.html">
   4. Corpus Analytics
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   5. Clustering and Classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_topic-modeling.html">
   6. Topic Modeling
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/05_clustering-and-classification.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/ucdavisdatalab/workshop_getting_started_with_textual_data"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/ucdavisdatalab/workshop_getting_started_with_textual_data/master?urlpath=tree/05_clustering-and-classification.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-vector-space-concept">
   5.1. The Vector Space Concept
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plotting-an-example">
     5.1.1. Plotting an example
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cosine-similarity">
     5.1.2. Cosine similarity
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#measuring-similarity">
   5.2. Measuring Similarity
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#generating-scores">
     5.2.1. Generating scores
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualizing-the-results">
     5.2.2. Visualizing the results
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#clustering-by-similarity">
   5.3. Clustering by Similarity
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="clustering-and-classification">
<h1><span class="section-number">5. </span>Clustering and Classification<a class="headerlink" href="#clustering-and-classification" title="Permalink to this headline">¶</a></h1>
<p>This chapter is a direct extension of the last. In Chapter 4, we learned how to build a corpus from a collection of
text files and produce different metrics about them using a document-term matrix. For the most part these metrics
hewed either toward the level of documents or the level of terms; we hadn’t yet discussed ways to more fully weave
these two aspects of our corpus together. We’ll do so now. In this chapter, we will learn how to identify
similarities between texts using a more general measure of the various features recorded in a document-term matrix.
With this measure, we’ll be able to cluster the obituaries in our corpus into distinct groups, which may in turn
tell us something about the overall shape of our corpus, its trends, its patterns, etc.</p>
<p>The applications of this technique are broad. Search engines use text similarity to identify relevant results for
queries; literature scholars consult it to investigate authorship and topicality. Below, we’ll walk through the
concepts that underly text similarity show a few examples of how to explore and interpret the results of this
measure.</p>
<div class="admonition-learning-objectives admonition">
<p class="admonition-title">Learning objectives</p>
<p>By the end of this chapter, you will be able to:</p>
<ul class="simple">
<li><p>Rank documents by similarity, using a cosine distance measure</p></li>
<li><p>Project documents into a feature space to visualize their similarities</p></li>
<li><p>Cluster documents by their similarities</p></li>
</ul>
</div>
<div class="section" id="the-vector-space-concept">
<h2><span class="section-number">5.1. </span>The Vector Space Concept<a class="headerlink" href="#the-vector-space-concept" title="Permalink to this headline">¶</a></h2>
<p>To measure similarities between documents, we need to make a bit of a conceptual leap. Imagine projecting every
document in our corpus into a space. In this space, similar documents have similar orientations to a point of
origin (in this case, the origin point of XY axes), while dissimilar ones have different orientations. Guiding
these orientations are the values for each term in a document. Here, <em>space is a metaphor for semantics</em>.</p>
<div class="section" id="plotting-an-example">
<h3><span class="section-number">5.1.1. </span>Plotting an example<a class="headerlink" href="#plotting-an-example" title="Permalink to this headline">¶</a></h3>
<p>We can build a toy example to demonstrate this. Imagine two documents, each with a value for two terms.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">ex1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">18</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">12</span><span class="p">]])</span>
<span class="n">ex1_dtm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ex1</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="s1">&#39;screen&#39;</span><span class="p">],</span> <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Document 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Document 2&#39;</span><span class="p">])</span>
<span class="n">ex1_dtm</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>page</th>
      <th>screen</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Document 1</th>
      <td>18</td>
      <td>7</td>
    </tr>
    <tr>
      <th>Document 2</th>
      <td>4</td>
      <td>12</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Since there are only two terms here, we can directly plot this data using XY coordinates.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">origin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="o">*</span><span class="n">origin</span><span class="p">,</span> <span class="n">ex1_dtm</span><span class="p">[</span><span class="s1">&#39;page&#39;</span><span class="p">],</span> <span class="n">ex1_dtm</span><span class="p">[</span><span class="s1">&#39;screen&#39;</span><span class="p">],</span> <span class="n">scale</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;xy&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xlim</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">ylim</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">xticks</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span> <span class="n">yticks</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">21</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;`screen` Count&#39;</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;`page` Count&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">ex1_dtm</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">ex1_dtm</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">doc</span><span class="p">,</span> <span class="s1">&#39;page&#39;</span><span class="p">],</span>
             <span class="n">ex1_dtm</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">doc</span><span class="p">,</span> <span class="s1">&#39;screen&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span>
             <span class="n">doc</span><span class="p">,</span>
             <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;top&#39;</span><span class="p">,</span>
             <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
            <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/05_clustering-and-classification_4_0.png" src="_images/05_clustering-and-classification_4_0.png" />
</div>
</div>
<p>In this plot, we’re particularly interested in the angle created by the two documents. Right now, this angle is
fairly wide, as the differences between the two counts in each document are rough inverses of one another. Document
1 has more counts for “page” than “screen,” whereas Document 2 is the other way around.</p>
<p>But if we change the counts in Document 1 to be more like those in Document 2…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ex2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">18</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">12</span><span class="p">]])</span>
<span class="n">ex2_dtm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ex2</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="s1">&#39;screen&#39;</span><span class="p">],</span> <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Document 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Document 2&#39;</span><span class="p">])</span>
<span class="n">ex2_dtm</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>page</th>
      <th>screen</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Document 1</th>
      <td>10</td>
      <td>18</td>
    </tr>
    <tr>
      <th>Document 2</th>
      <td>4</td>
      <td>12</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>…and replot our documents…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="o">*</span><span class="n">origin</span><span class="p">,</span> <span class="n">ex2_dtm</span><span class="p">[</span><span class="s1">&#39;page&#39;</span><span class="p">],</span> <span class="n">ex2_dtm</span><span class="p">[</span><span class="s1">&#39;screen&#39;</span><span class="p">],</span> <span class="n">scale</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;xy&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xlim</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">ylim</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">xticks</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span> <span class="n">yticks</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">21</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;`screen` Count&#39;</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;`page` Count&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">ex2_dtm</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">ex2_dtm</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">doc</span><span class="p">,</span> <span class="s1">&#39;page&#39;</span><span class="p">],</span>
             <span class="n">ex2_dtm</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">doc</span><span class="p">,</span> <span class="s1">&#39;screen&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span>
             <span class="n">doc</span><span class="p">,</span>
             <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;top&#39;</span><span class="p">,</span>
             <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
            <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/05_clustering-and-classification_8_0.png" src="_images/05_clustering-and-classification_8_0.png" />
</div>
</div>
<p>…we’ll see that the angle has shrunk considerably. Document 1 is more like Document 2. Importantly, this
similarity is relatively impervious to the actual value for each word. The counts for Document 1 and Document 2 are
still quite different, but the <em>overall relationship</em> between the values for each word is now similar: both
documents have more instances of “screen” than “page,” and our method of projecting them into this space, or what
we call a <strong>vector space</strong>, captures this.</p>
</div>
<div class="section" id="cosine-similarity">
<h3><span class="section-number">5.1.2. </span>Cosine similarity<a class="headerlink" href="#cosine-similarity" title="Permalink to this headline">¶</a></h3>
<p>We can assign a concrete metric to the difference in these angles using a <strong>cosine similarity</strong> score. Cosine
similarity measures the inner product space between two vectors, that is, the amount of space created by
divergences in the attribute values of each vector. Typically, we express it within a bounded interval, [0,1],
where 0 stands for a right angle between two vectors and 1 measures vectors that completely overlap.</p>
<p>Formally, we express cosine similarity as</p>
<div class="math notranslate nohighlight">
\[
similarity_{xy} = \frac{x \cdot y}{\Vert x \Vert \cdot \Vert y \Vert}
\]</div>
<p>where <span class="math notranslate nohighlight">\(x \cdot y\)</span> is the dot product of two vectors. But we don’t need to worry about implementing this ourselves.
<code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code> has a one-liner for this, which we can use on our two example vectors to demontrate how it works. It
will output a square matrix of values, where each cell is the cosine similarity measure of the intersection between
a column and a row. (You’ll note, for example, that there are 1s in the following matrices: these are the
intersections of a document with itself.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics.pairwise</span> <span class="kn">import</span> <span class="n">cosine_similarity</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cosine similarity for first example, where:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">ex1_dtm</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">ex1_dtm</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
<span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cosine_similarity</span><span class="p">(</span><span class="n">ex1</span><span class="p">),</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">ex1_dtm</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">ex1_dtm</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;...or, simplified: </span><span class="si">{</span><span class="n">cosine_similarity</span><span class="p">(</span><span class="n">ex1</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cosine similarity for first example, where:
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>page      18
screen     7
Name: Document 1, dtype: int64
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>page       4
screen    12
Name: Document 2, dtype: int64
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Document 1</th>
      <th>Document 2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Document 1</th>
      <td>1.000000</td>
      <td>0.638572</td>
    </tr>
    <tr>
      <th>Document 2</th>
      <td>0.638572</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>...or, simplified: 0.64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cosine similarity for second example, where:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">ex2_dtm</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">ex2_dtm</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
<span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cosine_similarity</span><span class="p">(</span><span class="n">ex2</span><span class="p">),</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">ex2_dtm</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">ex2_dtm</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;...or, simplified: </span><span class="si">{</span><span class="n">cosine_similarity</span><span class="p">(</span><span class="n">ex2</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cosine similarity for second example, where:
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>page      10
screen    18
Name: Document 1, dtype: int64
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>page       4
screen    12
Name: Document 2, dtype: int64
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Document 1</th>
      <th>Document 2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Document 1</th>
      <td>1.000000</td>
      <td>0.982872</td>
    </tr>
    <tr>
      <th>Document 2</th>
      <td>0.982872</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>...or, simplified: 0.98
</pre></div>
</div>
</div>
</div>
<p>Of the two examples, which one has more similar documents? Our second one: the cosine similarity score is 0.98, far
higher than 0.64.</p>
</div>
</div>
<div class="section" id="measuring-similarity">
<h2><span class="section-number">5.2. </span>Measuring Similarity<a class="headerlink" href="#measuring-similarity" title="Permalink to this headline">¶</a></h2>
<p>With the principles of text similarity laid out, we can load in the document-matrix we’ve already created and, for
each text in our corpus, compute a cosine similarity measure between that text and all the others. But rather
than only measuring the attribute values between two terms, as above, we’ll instead measure the values of every
single tf-idf score in our corpus.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">indir</span> <span class="o">=</span> <span class="s2">&quot;data/session_two/output/&quot;</span>
<span class="n">dtm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">indir</span> <span class="o">+</span> <span class="s2">&quot;tfidf_scores.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">dtm</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="p">:</span><span class="mi">115</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>absorb</th>
      <th>absorbed</th>
      <th>absorption</th>
      <th>abstain</th>
      <th>abstemious</th>
      <th>abstemiousness</th>
      <th>abstention</th>
      <th>abstinence</th>
      <th>abstinent</th>
      <th>abstract</th>
      <th>abstraction</th>
      <th>abstractions</th>
      <th>abstracts</th>
      <th>abstruse</th>
      <th>absurd</th>
    </tr>
    <tr>
      <th>NAME</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Ada Lovelace</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.055834</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Robert E Lee</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Andrew Johnson</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Bedford Forrest</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.023602</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Lucretia Mott</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>In other words, rather than our stories having only two attributes, they’ll have…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of each attributes per text:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtm</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of each attributes per text: 32548
</pre></div>
</div>
</div>
</div>
<p>We’re working in very high-dimensional space!</p>
<div class="section" id="generating-scores">
<h3><span class="section-number">5.2.1. </span>Generating scores<a class="headerlink" href="#generating-scores" title="Permalink to this headline">¶</a></h3>
<p>While this might be a bit hard to conceptualize (and indeed impossible to visualize), we can let <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code> do
the heavy lifting and inspect the condensed results. Doing so involves simply running <code class="docutils literal notranslate"><span class="pre">cosine_similarity()</span></code> across
the entire dataframe and assign the result to a new dataframe. The result will be a square matrix, where rows and
columns are each of the texts in our corpus.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">similarities</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cosine_similarity</span><span class="p">(</span><span class="n">dtm</span><span class="p">),</span>
                            <span class="n">columns</span> <span class="o">=</span> <span class="n">dtm</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                            <span class="n">index</span> <span class="o">=</span> <span class="n">dtm</span><span class="o">.</span><span class="n">index</span>
                           <span class="p">)</span>

<span class="n">similarities</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">5</span><span class="p">,</span> <span class="p">:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>NAME</th>
      <th>Ada Lovelace</th>
      <th>Robert E Lee</th>
      <th>Andrew Johnson</th>
      <th>Bedford Forrest</th>
      <th>Lucretia Mott</th>
    </tr>
    <tr>
      <th>NAME</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Ada Lovelace</th>
      <td>1.000000</td>
      <td>0.019792</td>
      <td>0.026927</td>
      <td>0.019026</td>
      <td>0.019723</td>
    </tr>
    <tr>
      <th>Robert E Lee</th>
      <td>0.019792</td>
      <td>1.000000</td>
      <td>0.139954</td>
      <td>0.157277</td>
      <td>0.030560</td>
    </tr>
    <tr>
      <th>Andrew Johnson</th>
      <td>0.026927</td>
      <td>0.139954</td>
      <td>1.000000</td>
      <td>0.098129</td>
      <td>0.055867</td>
    </tr>
    <tr>
      <th>Bedford Forrest</th>
      <td>0.019026</td>
      <td>0.157277</td>
      <td>0.098129</td>
      <td>1.000000</td>
      <td>0.018065</td>
    </tr>
    <tr>
      <th>Lucretia Mott</th>
      <td>0.019723</td>
      <td>0.030560</td>
      <td>0.055867</td>
      <td>0.018065</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now we can identify the most and least similar texts to a given obituary. Note that we need to get the second index
position for <code class="docutils literal notranslate"><span class="pre">most</span></code>, since the highest score will always be the obituary’s similarity to itself.</p>
<div class="margin sidebar">
<p class="sidebar-title">What this loop does</p>
<ol class="simple">
<li><p>For each person, sort every associated value, getting the second to highest first</p></li>
<li><p>Sort again and get the lowest value</p></li>
</ol>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">people</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Ada Lovelace&#39;</span><span class="p">,</span> <span class="s1">&#39;Henrietta Lacks&#39;</span><span class="p">,</span> <span class="s1">&#39;FDR&#39;</span><span class="p">,</span> <span class="s1">&#39;Miles Davis&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">people</span><span class="p">:</span>
    <span class="n">most</span> <span class="o">=</span> <span class="n">similarities</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">take</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">least</span> <span class="o">=</span> <span class="n">similarities</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">take</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;For </span><span class="si">{</span><span class="n">person</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">+ Most similar: </span><span class="si">{</span><span class="n">most</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">most</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2"> cosine similarity)&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">+ Least similar: </span><span class="si">{</span><span class="n">least</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">least</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2"> cosine similarity)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>For Ada Lovelace: 
+ Most similar: Karen Sparck Jones (0.180 cosine similarity) 
+ Least similar: Lou Gehrig (0.002 cosine similarity) 

For Henrietta Lacks: 
+ Most similar: Ross G Harrison (0.104 cosine similarity) 
+ Least similar: John W Heisman (0.006 cosine similarity) 

For FDR: 
+ Most similar: Eleanor Roosevelt (0.502 cosine similarity) 
+ Least similar: Carlos Montoya (0.013 cosine similarity) 

For Miles Davis: 
+ Most similar: Sammy Davis Jr (0.372 cosine similarity) 
+ Least similar: Charles Spaulding (0.008 cosine similarity) 
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="visualizing-the-results">
<h3><span class="section-number">5.2.2. </span>Visualizing the results<a class="headerlink" href="#visualizing-the-results" title="Permalink to this headline">¶</a></h3>
<p>It’s perhaps more helpful, however, to get a bird’s eye view of the entire corpus. But remember that <code class="docutils literal notranslate"><span class="pre">similarities</span></code>
has hundreds of attributes – far more than we can visualize. What we need to do, then, is reduce the dimensionality
of this data, decomposing the original values into a set of two for each text. We’ll use <strong>T-distributed Stochastic
Neighbor Embedding</strong> (t-SNE) to do this. In the most general sense, t-SNE takes in a matrix of multidimensional
data and decomposes it into a less complex representation of that original data. This simple version of the data
will roughly represent the most important features of the input matrix, which will set a given data point apart
from others.</p>
<p><code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code> has a built-in function for t-SNE. We call it like so:</p>
<div class="margin sidebar">
<p class="sidebar-title">Want to dive into the weeds?</p>
<p>The <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code> documentation offers a <a class="reference external" href="https://scikit-learn.org/stable/modules/manifold.html#t-sne">good overview</a> of t-SNE and supplies citations to the academic papers
that first introduced it.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.manifold</span> <span class="kn">import</span> <span class="n">TSNE</span>

<span class="n">reduced</span> <span class="o">=</span> <span class="n">TSNE</span><span class="p">(</span><span class="n">n_components</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> 
               <span class="n">learning_rate</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span> 
               <span class="n">init</span> <span class="o">=</span> <span class="s1">&#39;random&#39;</span><span class="p">,</span> 
               <span class="n">angle</span> <span class="o">=</span> <span class="mf">0.65</span><span class="p">,</span>
               <span class="n">random_state</span> <span class="o">=</span> <span class="mi">357</span><span class="p">)</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">similarities</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">reduced</span></code>, is a 2x<span class="math notranslate nohighlight">\(n\)</span> matrix, where <span class="math notranslate nohighlight">\(n\)</span> is the number of rows in the original matrix. We can isolate each of
the dimensions in <code class="docutils literal notranslate"><span class="pre">reduced</span></code> and assign them to X and Y coordinates, respectively.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vis_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">reduced</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="n">reduced</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="n">similarities</span><span class="o">.</span><span class="n">index</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<p>And with this done, we can plot the result. We’ll also use a quick <code class="docutils literal notranslate"><span class="pre">lambda</span></code> function to plot the names of the
people from before.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">vis_data</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">);</span>
<span class="n">vis_data</span><span class="p">[</span><span class="n">vis_data</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">people</span><span class="p">)][[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;NAME&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/05_clustering-and-classification_28_0.png" src="_images/05_clustering-and-classification_28_0.png" />
</div>
</div>
<div class="margin sidebar">
<p class="sidebar-title">A caveat</p>
<p>It’s important to remember that the transformation between high dimensional space and this 2D plot is a lossy one.
Distortions will result from it, and having a good sense of what kind of distortions you might expect to see with
t-SNE will help you interpret these graphs. This <a class="reference external" href="https://distill.pub/2016/misread-tsne/">interactive dashboard</a> offers a really nice overview of these
considerations.</p>
</div>
<p>As with our toy example above, here, space has semantic value. Points that appear closer together in the
visualization above have more similarities between them than those that are farther apart. We can see this clearly
if we show a person’s point and the most similar point to that person.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">roosevelts</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;FDR&#39;</span><span class="p">,</span> <span class="s1">&#39;Eleanor Roosevelt&#39;</span><span class="p">]</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">vis_data</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">);</span>
<span class="n">vis_data</span><span class="p">[</span><span class="n">vis_data</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">roosevelts</span><span class="p">)][[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;NAME&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/05_clustering-and-classification_30_0.png" src="_images/05_clustering-and-classification_30_0.png" />
</div>
</div>
<p>Quite close!</p>
</div>
</div>
<div class="section" id="clustering-by-similarity">
<h2><span class="section-number">5.3. </span>Clustering by Similarity<a class="headerlink" href="#clustering-by-similarity" title="Permalink to this headline">¶</a></h2>
<p>The last topic we’ll cover in this chapter involves dividing up the feature space of our data so as to broadly
cluster the texts in our corpus. This will give us a frame for considering general trends in the data, which in
turn may better help us understand the specificity of individual texts. For example, clustering might allow us to
speak about various subgenres of obituaries. Similarly, it could tell us something about how the <em>New York Times</em>
writes about particular kinds of people (their vocations, their backgrounds, etc.). It may even indicate something
about how the style of the obituary has changed over time.</p>
<p>But how to do it? Visual inspection of the graphs above would be one way. There are a few discernible clusters in
it. Consider the division in points that cuts up toward the right from the bottom center of the graph; there’s a
particularly dense patch of points near the Roosevelts’ position as well. But while could slice and dice these
points using visual cues for ages, these cues can sometimes be misleading. It would be better, then, to use
unsupervised methods to automatically partition our feature space.</p>
<p>There are a host of different such techniques available. Below, we’ll use <strong>hierarchical clustering</strong>. In
hierarchical clustering, each data point is treated as an individual cluster before being successfully merged with
its most similar point. Then, this new cluster is merged with another cluster, and the process repeats. Merging
continues in an upward fashion until the process reaches a predetermined number of clusters.</p>
<p>We can’t go into detail about how to determine the best number of clusters for a dataset. It’s a complex topic, and
much depends on a) your data; and b) what you want to know about your data. For now, we’ll stick with a general,
rather rudimentary approach, which you can nuance later on.</p>
<p>Once again, <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code> has functionality for clustering. We just need to initialize and fit an
<code class="docutils literal notranslate"><span class="pre">AgglomerativeClustering()</span></code> object to our similarities, defining along the way the number of clusters we’d like to
generate.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">AgglomerativeClustering</span>

<span class="n">n_clusters</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">AgglomerativeClustering</span><span class="p">(</span><span class="n">n_clusters</span> <span class="o">=</span> <span class="n">n_clusters</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">similarities</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The result will be a fitted <code class="docutils literal notranslate"><span class="pre">AgglomerativeClustering()</span></code> object, which works much like <code class="docutils literal notranslate"><span class="pre">CountVectorizer()</span></code> or
<code class="docutils literal notranslate"><span class="pre">TfidfVectorizer()</span></code> in the last chapter. We can access its <code class="docutils literal notranslate"><span class="pre">labels_</span></code> attribute and assign a cluster label to each
point in our data. We’ll also use this attribute to add some color to our visualization, which will make it easier
to discern the clusters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vis_data</span> <span class="o">=</span> <span class="n">vis_data</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">CLUSTER</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">labels_</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">vis_data</span> <span class="o">=</span> <span class="n">vis_data</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">COLOR</span> <span class="o">=</span> <span class="n">vis_data</span><span class="p">[</span><span class="s1">&#39;CLUSTER&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;green&#39;</span><span class="p">}))</span>
</pre></div>
</div>
</div>
</div>
<p>And now we can visualize. We’ll sample a few names and show those as well.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">vis_data</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;COLOR&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">)</span>
<span class="n">vis_data</span><span class="p">[[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;NAME&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/05_clustering-and-classification_37_0.png" src="_images/05_clustering-and-classification_37_0.png" />
</div>
</div>
<p>Not bad at all! There are a few incursions of one cluster into another, but for the most part this looks pretty
coherent (it may even be that those incursions are exaggerated by the visualization, as the note above explains).
Let’s grab some examples of each cluster and show them.</p>
<div class="margin sidebar">
<p class="sidebar-title">What this loop does</p>
<ol class="simple">
<li><p>Group the data by <code class="docutils literal notranslate"><span class="pre">CLUSTER</span></code></p></li>
<li><p>For each group, sample <code class="docutils literal notranslate"><span class="pre">n_samples</span></code></p></li>
<li><p>Print each name in the sampled results</p></li>
</ol>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_samples</span> <span class="o">=</span> <span class="mi">5</span>
<span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">vis_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;CLUSTER&#39;</span><span class="p">):</span>
    <span class="n">cluster</span> <span class="o">=</span> <span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cluster: </span><span class="si">{</span><span class="n">cluster</span><span class="si">}</span><span class="se">\n</span><span class="s2">----------&quot;</span><span class="p">)</span>
    <span class="n">sampled</span> <span class="o">=</span> <span class="n">subset</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n_samples</span><span class="p">)[</span><span class="s1">&#39;NAME&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">sampled</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cluster: 1
----------
Leonard Bernstein
Federico Fellini
Greta Garbo
John Philip Sousa
James Cagney


Cluster: 2
----------
Chaim Weizmann
Alfred E Smith
Herbert Hoover
Ralph Bunche
Jacqueline Kennedy


Cluster: 3
----------
Gertrude Stein
Nella Larsen
Primo Levi
Queen Victoria
Alfred Eisenstaedt
</pre></div>
</div>
</div>
</div>
<p>Looking over these results turns up an interesting pattern: one way to interpret these clusters is by profession.
The people in the first cluster tend to be entertainers, usually popular ones working in/with popular media forms;
Billie Holiday and Marilyn Monroe are in this cluster, for example. Those in the second one, on the other hand,
tend to be political figures: Ghandi, Adlai Stevenson, and so on. Finally, those in cluster three are often
novelists, activists, and other kinds of public figures; Helen Keller is in this cluster, along with Joseph
Pulitzer and Jackie Robinson. From an initial glance, then, our text similarity data seems to suggest that <em>a
person’s profession indicates something about the type of obituary they have</em>.</p>
<p>Of course, there are intriguing exceptions. Eugene O’Neill, a playwright, is in the second cluster, whereas the
division we’ve just suggested would put him in the third cluster, alongside Sylvia Plath and James Joyce. The Duke
of Windsor (Edward VIII) is an interesting test case: he is a political figure, though he quickly abdicated from
the throne. Should he therefore be in the second cluster or, as he is here, in the third cluster?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">unexpected</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Eugene O Neill&#39;</span><span class="p">,</span> <span class="s1">&#39;The Duke of Windsor&#39;</span><span class="p">]</span>
<span class="n">vis_data</span><span class="p">[</span><span class="n">vis_data</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">unexpected</span><span class="p">)][[</span><span class="s1">&#39;NAME&#39;</span><span class="p">,</span> <span class="s1">&#39;CLUSTER&#39;</span><span class="p">,</span> <span class="s1">&#39;COLOR&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">hide_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style  type="text/css" >
</style><table id="T_f143b_" ><thead>    <tr>        <th class="col_heading level0 col0" >NAME</th>        <th class="col_heading level0 col1" >CLUSTER</th>        <th class="col_heading level0 col2" >COLOR</th>    </tr></thead><tbody>
                <tr>
                                <td id="T_f143b_row0_col0" class="data row0 col0" >Eugene O Neill</td>
                        <td id="T_f143b_row0_col1" class="data row0 col1" >2</td>
                        <td id="T_f143b_row0_col2" class="data row0 col2" >blue</td>
            </tr>
            <tr>
                                <td id="T_f143b_row1_col0" class="data row1 col0" >The Duke of Windsor</td>
                        <td id="T_f143b_row1_col1" class="data row1 col1" >3</td>
                        <td id="T_f143b_row1_col2" class="data row1 col2" >green</td>
            </tr>
    </tbody></table></div></div>
</div>
<p>The question for both exceptions is why. What is it about these two people – or more specifically, their obituaries
– that pushes them outside the cluster we’d expect them to be in? Is it a particular set of words? Lexical
diversity? Something else?</p>
<p>Investigating these questions will take us beyond the scope of this chapter. For now, it’s enough to know that text
similarity prompts them and that we can explore and analyze corpora using this metric. We’ll end, then, with this
preliminary hypothesis about our clusters, which later work will need to either corroborate or challenge.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "nlp"
        },
        kernelOptions: {
            kernelName: "nlp",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'nlp'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="04_corpus-analytics.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title"><span class="section-number">4. </span>Corpus Analytics</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="06_topic-modeling.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title"><span class="section-number">6. </span>Topic Modeling</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Tyler Shoemaker and Carl Stahmer<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>